
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Logic</title><script src="coq2html.js"></script>
<meta name="description" content="Documentation of Coq module Logic" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h1 class="title">Module Logic</h1>
<div class="coq">
<br/>
<span class="kwd">From</span> <span class="id">Staged</span> <span class="kwd">Require</span> <span class="kwd">Export</span> <span class="id">HeapF</span> <span class="id">LibFmap</span> <span class="id">ExtraTactics</span>.<br/>
<br/>
<span class="kwd">From</span> <span class="id">ShiftReset</span> <span class="kwd">Require</span> <span class="kwd">Export</span><br/>
&nbsp;&nbsp;<span class="id">Basics</span> <span class="id">ShiftFree</span> <span class="id">Propriety</span> <span class="id">Reduction</span><br/>
&nbsp;&nbsp;<span class="id">Satisfies</span> <span class="id">Biab</span> <span class="id">Norm</span> <span class="id">Ent</span> <span class="id">GEnt</span><br/>
&nbsp;&nbsp;<span class="id">ReductionOld</span>.<br/>
<br/>
<span class="kwd">Implicit</span> <span class="id">Types</span> <span class="id">a</span> <span class="id">v</span> <span class="id">r</span> : <span class="id">val</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">EnvFraming</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">satisfies_env_frame</span> : <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">R</span> <span class="id">f</span> <span class="id">k</span> <span class="id">u</span>,<br/>
&nbsp;&nbsp;~ <span class="id">Fmap.indom</span> <span class="id">s1</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">satisfies</span> (<span class="id">Fmap.update</span> <span class="id">s1</span> <span class="id">k</span> <span class="id">u</span>) <span class="id">s2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">R</span> <span class="id">f</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id">satisfies</span> <span class="id">s1</span> (<span class="id">Fmap.remove</span> <span class="id">s2</span> <span class="id">k</span>) <span class="id">h1</span> <span class="id">h2</span> <span class="id">R</span> <span class="id">f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">introv</span> <span class="id">Hfresh</span>.<br/>
&nbsp;&nbsp;<span class="id">iff</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{ <span class="id">remember</span> (<span class="id">Fmap.update</span> <span class="id">s1</span> <span class="id">k</span> <span class="id">u</span>) <span class="kwd">as</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">induction</span> <span class="id">H</span>; <span class="id">subst</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">applys</span> <span class="id">s_req</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">specializes</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">rewrites</span> (&gt;&gt; <span class="id">remove_update</span> <span class="id">Hfresh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_ens</span>. <span class="id">heaps</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">applys</span> <span class="id">s_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specializes</span>* <span class="id">IHsatisfies1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">b</span>&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_fex</span>. <span class="kwd">exists</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;another&nbsp;broken&nbsp;induction&nbsp;principle&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">IHsatisfies</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">classic</span> (<span class="id">k</span> = <span class="id">xf</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_unk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> <span class="id">fmap_read_update</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Admitted.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id">ent_env_frame</span> : <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">k</span> <span class="id">u</span> <span class="id">f1</span> <span class="id">f2</span>,<br/>
&nbsp;&nbsp;~ <span class="id">Fmap.indom</span> <span class="id">s1</span> <span class="id">k</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">entails_under</span> <span class="id">s1</span> <span class="id">f1</span> <span class="id">f2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">entails_under</span> (<span class="id">Fmap.update</span> <span class="id">s1</span> <span class="id">k</span> <span class="id">u</span>) <span class="id">f1</span> <span class="id">f2</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">entails_under</span>. <span class="id">introv</span> <span class="id">Hfresh</span> <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span>~ <span class="id">satisfies_env_frame</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">H</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span>~ &lt;- <span class="id">satisfies_env_frame</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eassumption</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">End</span> <span class="id">EnvFraming</span>.<br/>
<br/>
<h1> Reduction example </h1>
<br/>
<span class="kwd">Example</span> <span class="id">ex_rewrite_right</span>:<br/>
&nbsp;&nbsp;<span class="id">entails</span> (<span class="id">ens_</span> \[<span class="id">True</span>]) (<span class="id">ens_</span> \[<span class="id">True</span>];; <span class="id">ens_</span> \[<span class="id">True</span>];; <span class="id">ens_</span> \[<span class="id">True</span>]).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="comment">(*&nbsp;Set&nbsp;Typeclasses&nbsp;Debug.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">norm_ens_ens_void</span>.<br/>
Abort.</div></details>
<br/>
<span class="kwd">Example</span> <span class="id">ex_rewrite_right1</span>:<br/>
&nbsp;&nbsp;<span class="id">entails_under</span> <span class="id">empty_env</span> (<span class="id">ens_</span> \[<span class="id">True</span>]) (<span class="id">ens_</span> \[<span class="id">True</span>];; <span class="id">ens_</span> \[<span class="id">True</span>];; <span class="id">ens_</span> \[<span class="id">True</span>]).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">H1</span> <span class="id">H2</span>, <span class="id">entails_under</span> <span class="id">empty_env</span> (<span class="id">ens_</span> <span class="id">H1</span>;; <span class="id">ens_</span> <span class="id">H2</span>) (<span class="id">ens_</span> (<span class="id">H1</span> \* <span class="id">H2</span>))) <span class="kwd">as</span> ?. <span class="id">admit</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="kwd">forall</span> <span class="id">H1</span> <span class="id">H2</span>, <span class="id">entails_under</span> <span class="id">empty_env</span> (<span class="id">ens_</span> (<span class="id">H1</span> \* <span class="id">H2</span>)) (<span class="id">ens_</span> <span class="id">H1</span>;; <span class="id">ens_</span> <span class="id">H2</span>)) <span class="kwd">as</span> ?. <span class="id">admit</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;rewrite&nbsp;norm_ens_ens_void.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Set&nbsp;Typeclasses&nbsp;Debug.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;rewrite&nbsp;H.<br/>
&nbsp;&nbsp;rewrite&nbsp;H0.<br/>
&nbsp;&nbsp;rewrite&nbsp;&lt;-&nbsp;H.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">H</span>.<br/>
<br/>
Abort.</div></details>
<br/>
<br/>
<h1> Correspondence with the paper </h1>
<h2> Differences </h2>
<div class="doc"><!-- this space is needed!!-->
<ul>
<li>
 Function pointer values <span class="bracket"><span class="id">vfptr</span></span> enable arbitrary higher-order staged formulae. A <span class="bracket"><span class="id">defun</span></span> staged formula (conceptually just an <span class="bracket"><span class="id">ens</span></span> which binds a function value) and an output <span class="bracket"><span class="id">senv</span></span> added to <span class="bracket"><span class="id">satisfies</span></span> complete this, allowing shift bodies to return continuations.
</li>
<li>
 The semantics guarantees that <span class="bracket"><span class="id">shft</span></span>/<span class="bracket"><span class="id">Sh</span>#</span> continuations are <i>shift-free by construction</i>, by having a <span class="bracket"><span class="id">rs</span></span> as their topmost form. This significantly simplifies the proofs of the reduction rules. </li>
</ul>
</div>
<h2> Section 4.3. Shift/Reset Reduction </h2>
<div class="doc">The reduction rules are proved as lemmas.
<ul>
<li>
 <a href="&num;red_skip">red_skip</a>
</li>
<li>
 <a href="&num;red_normal">red_normal</a>
</li>
<li>
 <a href="&num;red_init">red_init</a>
</li>
<li>
 <a href="&num;red_extend">red_extend</a>
</li>
<li>
 <a href="&num;red_acc">red_acc</a>
</li>
<li>
 <a href="&num;red_shift_elim">red_shift_elim</a> </li>
</ul>
</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
