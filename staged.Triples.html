
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Triples</title>
<meta name="description" content="Documentation of Coq module Triples" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h1 class="title">Module Triples</h1>
<div class="coq">
<br/>
<span class="kwd">From</span> <span class="id">Staged</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Logic</span>.<br/>
<span class="id">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">Soundness</span>.<br/>
<span class="kwd">Import</span> <span class="id">HistoryTriples</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">sem_padd</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>,<br/>
&nbsp;&nbsp;<span class="id">spec_assert</span> (<span class="id">padd</span> (<span class="id">pval</span> (<span class="id">vint</span> <span class="id">x</span>)) (<span class="id">pval</span> (<span class="id">vint</span> <span class="id">y</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ens</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; \[<span class="id">r</span> = <span class="id">vint</span> (<span class="id">x</span>+<span class="id">y</span>)])).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">spec_assert</span>, <span class="id">pair_valid_under</span>. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_ens</span>. <span class="id">exs</span>.<br/>
&nbsp;&nbsp;<span class="id">splits</span>*.<br/>
&nbsp;&nbsp;<span class="id">hintro</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">fmap_eq</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id">hist_padd</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">fh</span>,<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> <span class="id">fh</span> (<span class="id">padd</span> (<span class="id">pval</span> (<span class="id">vint</span> <span class="id">x</span>)) (<span class="id">pval</span> (<span class="id">vint</span> <span class="id">y</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fh</span>;; <span class="id">ens</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; \[<span class="id">r</span> = <span class="id">vint</span> (<span class="id">x</span>+<span class="id">y</span>)])).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_frame_sem</span> (@<span class="id">sem_padd</span> <span class="id">x</span>).<br/>
Qed.</div></details>
<br/>
<div class="doc">Simpler, more elementary alternative to biabduction </div>
<span class="kwd">Lemma</span> <span class="id">norm_ens_forall_req</span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;<span class="id">entails</span> (<span class="id">ens_</span> (<span class="id">l</span> ~~&gt; <span class="id">v</span>);; <span class="id">∀</span> <span class="id">y</span>, <span class="id">req</span> (<span class="id">l</span> ~~&gt; <span class="id">y</span>) <span class="id">f</span>) <span class="id">f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">entails</span>. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H7</span>. <span class="id">specializes</span> <span class="id">H4</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H6</span>. <span class="id">destr</span> <span class="id">H5</span>. <span class="id">hinv</span> <span class="id">H0</span>. <span class="id">hinv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H4</span>. <span class="id">specializes</span> <span class="id">H13</span> <span class="id">x0</span> <span class="id">h1</span>.<br/>
Qed.</div></details>
<br/>
<div class="doc">Like <span class="bracket"><span class="id">norm_ens_forall_req</span></span> but for a dependent body </div>
<span class="kwd">Lemma</span> <span class="id">norm_ens_forall_req_dep</span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">f</span>,<br/>
&nbsp;&nbsp;<span class="id">entails</span> (<span class="id">ens_</span> (<span class="id">l</span> ~~&gt; <span class="id">v</span>);; <span class="id">∀</span> <span class="id">y</span>, <span class="id">req</span> (<span class="id">l</span> ~~&gt; <span class="id">y</span>) (<span class="id">f</span> <span class="id">y</span>)) (<span class="id">f</span> <span class="id">v</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">entails</span>. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H7</span>. <span class="id">specializes</span> <span class="id">H4</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H6</span>. <span class="id">destr</span> <span class="id">H5</span>. <span class="id">hinv</span> <span class="id">H0</span>. <span class="id">hinv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H4</span>. <span class="id">specializes</span> <span class="id">H13</span> <span class="id">x0</span> <span class="id">h1</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id">hist_triple_req_ens</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">H</span> <span class="id">e</span> <span class="id">fh</span>,<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> (<span class="id">fh</span>;; <span class="id">ens_</span> <span class="id">H</span>) <span class="id">e</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> <span class="id">fh</span> <span class="id">e</span> (<span class="id">req</span> <span class="id">H</span> <span class="id">f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_pre_result</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">hist_triple</span> <span class="kwd">in</span> *. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_req</span>. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">H0</span> <span class="id">penv</span> <span class="id">env</span> <span class="id">h0</span> (<span class="id">h1</span> \<span class="id">u</span> <span class="id">hp</span>) (<span class="id">norm</span> <span class="id">vunit</span>).<br/>
&nbsp;&nbsp;<span class="id">forward</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;hp&nbsp;satisfies&nbsp;H.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;to&nbsp;show&nbsp;that&nbsp;e's&nbsp;execution&nbsp;does&nbsp;not&nbsp;rely&nbsp;on&nbsp;hp.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;(h1-hp)-e-&gt;(h2-hp)&nbsp;still&nbsp;gives&nbsp;the&nbsp;same&nbsp;result.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;}<br/>
Abort.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id">hist_triple_req_ens_pure</span>: <span class="kwd">forall</span> <span class="id">f</span> <span class="id">P</span> <span class="id">e</span> <span class="id">fh</span>,<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> (<span class="id">fh</span>;; <span class="id">ens_</span> \[<span class="id">P</span>]) <span class="id">e</span> <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> <span class="id">fh</span> <span class="id">e</span> (<span class="id">req</span> \[<span class="id">P</span>] <span class="id">f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_pre_result</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">hist_triple</span> <span class="kwd">in</span> *. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_req</span>. <span class="id">intros</span>. <span class="id">hinv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">H</span> <span class="id">penv</span> <span class="id">env</span> <span class="id">h0</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">H</span> <span class="id">v</span> (<span class="id">norm</span> <span class="id">vunit</span>).<br/>
&nbsp;&nbsp;<span class="id">forward</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H14</span>. <span class="id">destr</span> <span class="id">H11</span>. <span class="id">hinv</span> <span class="id">H7</span>. <span class="id">hinv</span> <span class="id">H7</span>. <span class="id">hinv</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_seq</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">rew_fmap</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applys</span>* <span class="id">ens_void_pure_intro</span> <span class="id">P</span>. }<br/>
&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">rew_fmap</span> *.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Lemma</span> <span class="id">hist_triple_passign_update</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> (<span class="id">ens_</span> (<span class="id">l</span> ~~&gt; <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">passign</span> (<span class="id">pval</span> (<span class="id">vloc</span> <span class="id">l</span>)) (<span class="id">pval</span> <span class="id">v</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ens_</span> (<span class="id">l</span> ~~&gt; <span class="id">v</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">hist_triple</span>, <span class="id">pair_valid_under</span>. <span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H</span>. <span class="id">destr</span> <span class="id">H6</span>. <span class="id">hinv</span> <span class="id">H1</span>. <span class="id">hinv</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">hinv</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">rew_fmap</span> *.<br/>
&nbsp;&nbsp;<span class="id">clear</span> <span class="id">H5</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrites</span> (&gt;&gt; <span class="id">union_comm_of_disjoint</span> <span class="id">H4</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Fmap.update_eq_union_single</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">update_precedence</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Fmap.disjoint_sym</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">lets</span>: <span class="id">Fmap.disjoint_single_set</span> <span class="id">v</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_ens</span>.<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">vunit</span>, (<span class="id">Fmap.single</span> <span class="id">l</span> <span class="id">v</span>). <span class="id">splits</span>*.<br/>
&nbsp;&nbsp;<span class="id">hintro</span>. <span class="id">splits</span>*.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hsingle_intro</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">Fmap.update</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">union_comm_of_disjoint</span> <span class="id">H</span>.<br/>
Qed.</div></details>
<br/>
<span class="kwd">Example</span> <span class="id">ex0</span>: <span class="kwd">forall</span> <span class="id">a</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id">hist_triple</span> (<span class="id">ens_</span> (<span class="id">l</span>~~&gt;<span class="id">vint</span> <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">plet</span> <span class="string">"x"</span> (<span class="id">pderef</span> (<span class="id">pval</span> (<span class="id">vloc</span> <span class="id">l</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">plet</span> <span class="string">"y"</span> (<span class="id">padd</span> (<span class="id">pval</span> (<span class="id">vint</span> 1)) (<span class="id">pvar</span> <span class="string">"x"</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">passign</span> (<span class="id">pval</span> (<span class="id">vloc</span> <span class="id">l</span>)) (<span class="id">pvar</span> <span class="string">"y"</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ens_</span> (<span class="id">l</span>~~&gt;<span class="id">vint</span> (<span class="id">a</span>+1))).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_plet</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_pderef</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">vint</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">flow_res</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">inverts</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H6</span>. <span class="id">destr</span> <span class="id">H4</span>. <span class="id">hinv</span> <span class="id">H0</span>. <span class="id">hinv</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H7</span>. <span class="id">specializes</span> <span class="id">H13</span> (<span class="id">vint</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H13</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specializes</span> <span class="id">H12</span> <span class="id">x0</span> <span class="id">h1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">forward</span> <span class="id">H12</span>. <span class="id">fmap_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">forward</span> <span class="id">H12</span>. <span class="id">fmap_disjoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H12</span>. <span class="id">destr</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hinv</span> <span class="id">H0</span>. <span class="id">hinv</span> <span class="id">H0</span>. <span class="id">subst</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_plet</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_padd</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">instantiate</span> (1 := <span class="id">vint</span> (1+<span class="id">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">flow_res</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">inverts</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H7</span>. <span class="id">destr</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">hist_pre_result</span>.<br/>
&nbsp;&nbsp;<span class="id">applys</span> <span class="id">hist_conseq</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">norm_ens_forall_req_dep</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">norm_ens_ens_combine</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">entails</span> (<span class="id">ens</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; \<span class="kwd">exists</span> <span class="id">r1</span>, (\[<span class="id">r1</span> = <span class="id">vint</span> <span class="id">a</span>] \* <span class="id">l</span> ~~&gt; <span class="id">vint</span> <span class="id">a</span>) \* \[<span class="id">r</span> = <span class="id">vint</span> (1 + <span class="id">a</span>)]);; <span class="id">empty</span>) (<span class="id">ens_</span> (<span class="id">l</span>~~&gt;<span class="id">vint</span> <span class="id">a</span>))).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id">entails</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inverts</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">heaps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applys</span> <span class="id">s_ens</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">zap</span>. <span class="id">hintro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">zap</span>. <span class="id">hintro</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">applys_eq</span> <span class="id">hist_triple_passign_update</span>.<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</div></details>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
